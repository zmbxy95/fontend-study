## 内存管理
内存管理包含三个方面：申请空间、使用空间、释放空间
JavaScript中的垃圾
- JavaScript中内存管理是自动的
- 对象不在被引用时是垃圾
- 对象不能从根上访问到时是垃圾
JavaScript中的可达对象
- 可以访问到的对象就是可达对象（引用、作用域链）
- 可达的标准就是从根出发是否能够找到
- JavaScript中的根可以理解为全局对象
## 垃圾回收与常见GC算法
### GC定义与作用
- GC就是垃圾回收机制的简写
- GC可以找到内存中的垃圾、并释放和回收空间
### GC里的垃圾是什么？
- 程序中不再使用的对象
- 程序中访问不到的对象
### GC算法是什么？
- GC是一种机制，垃圾会搜其完成具体工作
- 工作的内容就是查找垃圾、释放空间与回收空间
- 算法就是工作时查找和回收所遵循的规则
### 常见的GC算法
#### 引用计数
核心思想：设置引用数，判断当前引用数是否为0。
- 引用计数器
- 引用关系改变时修改引用数字
- 当引用数字为0时立即回收
优点：
- 发现垃圾立即回收
- 最大限度减少程序暂停
缺点
- 无法回收循环引用的对象
- 事件开销大
#### 标记清除
核心思想：分标记和清除两个阶段完成
- 遍历所有对象，查找并标记活动对象
- 遍历所有对象，清除没有标记的对象
- 回收相应的空间
优点
- 可以回收循环引用的对象
缺点
- 容易产生碎片空间，造成浪费
- 不会立即回收垃圾对象
#### 标记整理
- 标记整理算法可以看作是标记清除算法的增强
- 标记阶段的操作和标记清除一致
- 清除阶段会线性执行整理，移动对象位置
优点
- 减少碎片空间
缺点
- 不会立即回收垃圾对象
- 移动对象位置，回收效率慢
#### 分代回收
## V8引擎
- V8是一款主流的JavaScript执行引擎
- V8采用及时编译
- V8内存设限
### V8垃圾回收策略
- 采用分代回收的思想
- 内存分为新生代、老生代
- 针对不同对象采用不同算法
### V8中常用的GC算法
- 分代回收
- 空间复制
- 标记清除
- 标记整理
- 标记增量
### V8内存分配
- V8空间一分为二
- 小空间用于存储新生代对象（32M/16M）
- 新生代指的是存活时间短的对象
- 老生代对象存放在右侧老生代区域
- 老生代对象空间在64位操作系统1.4G，32位操作系统700M
- 老生代对象就是指存货时间较长的对象
### V8中新生代对象回收
- 回收过程采用复制算法 + 标记整理
- 新生代内存区分为两个等大小空间
- 使用空间为Form，空闲空间为To
- 活动对象存储于Form空间
- 标记整理后将挥动对象拷贝至To
- Form与To交换空间完成释放
回收细节说明：
- 拷贝过程中可能出现晋升
- 晋升就是将新生代对象移动至老生代
- 一轮GC还存货的新生代对象需要晋升
- To空间的使用率超过25%
### V8中老生代对象回收
- 采用标记清除、标记整理、增量标记算法
- 首先使用标记清除安城垃圾空间的回收
- 采用标记整理进行空间优化
- 采用增量标记进行效率优化
与新生代垃圾回收细节对比：
- 新生代区域垃圾回收使用空间交换时间
- 老生代区域垃圾回收不适合复制算法